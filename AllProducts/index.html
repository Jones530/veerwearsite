<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Grin & Glisten — All Products</title>
  <link rel="icon" type="image/x-icon" href="/static/favicon.ico">

  <!-- Google font preload (user-provided) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pirata+One&display=swap" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Feather icons -->
  <script src="https://unpkg.com/feather-icons"></script>

  <!-- Snipcart (static ecommerce) -->
  <link rel="stylesheet" href="https://cdn.snipcart.com/themes/v3.3.0/default/snipcart.css" />
  <script async src="https://cdn.snipcart.com/themes/v3.3.0/default/snipcart.js"></script>
  <!-- TODO: Replace with your Snipcart public API key in the snipcart div at the end -->

  <style>
    /* ---------- fonts, variables and base ---------- */
    @font-face { font-family: "Monument Extended"; src: url("/fonts/MonumentExtended-FreeForPersonalUse/MonumentExtended-Regular.woff2") format("woff2"), url("/fonts/MonumentExtended-FreeForPersonalUse/MonumentExtended-Regular.ttf") format("truetype"); font-weight: 400; font-style: normal; font-display: swap; }
    @font-face { font-family: "Monument Extended Ultrabold"; src: url("/fonts/MonumentExtended-FreeForPersonalUse/MonumentExtended-Ultrabold.otf") format("opentype"); font-weight: 900; font-style: normal; font-display: swap; }
    @font-face { font-family: "Plunct"; src: url("/fonts/Plunct(1).woff2") format("woff2"); font-weight: 400 800; font-style: normal; font-display: swap; }
    @font-face { font-family: 'Pirata One'; src: url('/fonts/PirataOne-Regular.ttf') format('truetype'); font-weight: 400; font-style: normal; font-display: swap; }

    :root { --gold:#D4AF37; --gold-dark:#B58826; --black:#000; --white:#fff; --veer-deep:#B30000; }

    html { font-size:112.5%; }
    html,body { font-family:"Pirata One","Monument Extended",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif; margin:0; color:var(--black); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }

    .plunct{ font-family:"Plunct","Pirata One","Monument Extended",sans-serif; font-weight:700; }
    .veerwear{ font-family:"Monument Extended Ultrabold","Monument Extended","Pirata One",sans-serif; color:var(--veer-deep); font-weight:900; text-transform:uppercase; letter-spacing:0.6px; }
    .monument{ font-family:"Monument Extended","Pirata One",sans-serif; font-weight:700; }

    .bag-count{ font-family:"Monument Extended Ultrabold", "Monument Extended", sans-serif; font-weight:900; font-size:11px; line-height:1; }

    .select-with-icon select, #sortSelect { font-family:"Pirata One","Monument Extended",system-ui,sans-serif; }

    /* Hero: doubled vertical real estate */
    .shop-hero {
      position: relative;
      background-image: url('/images/fantasmagorie.gif');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      color:#fff;
      overflow:hidden;
      padding-top:8rem;     /* doubled vertical space */
      padding-bottom:8rem;
      min-height: 60vh;
      display:flex;
      align-items:center;
    }
    @media (max-width:767px){
      .shop-hero{ padding-top:6rem; padding-bottom:6rem; min-height:45vh; }
    }
    .shop-hero .overlay{ position:absolute; inset:0; background:rgba(0,0,0,0.35); pointer-events:none; }
    .shop-hero .hero-inner{ position:relative; z-index:2; }

    /* filter panel sticky */
    .filter-panel{ position:sticky; top:96px; max-height:calc(100vh - 110px); overflow:auto; padding-right:8px; }
    .filter-panel::-webkit-scrollbar{ width:8px; } .filter-panel::-webkit-scrollbar-thumb{ background:rgba(0,0,0,0.08); border-radius:6px; }

    .merch-inline-img{ width:20px; height:20px; object-fit:contain; margin-right:8px; display:inline-block; vertical-align:middle; }
    .badge-gold{ background:var(--gold); color:#000; font-weight:900; padding:4px 8px; border-radius:6px; font-size:11px; }

    .product-card{ border:1px solid rgba(0,0,0,0.06); box-shadow:0 6px 18px rgba(0,0,0,0.06); transition:transform .18s ease, box-shadow .18s ease; }
    .product-card:hover{ transform:translateY(-6px); box-shadow:0 14px 30px rgba(0,0,0,0.08); }

    /* pagination buttons styling */
    .page-btn {
      transition: all .16s ease;
      background: transparent;
      border: 1px solid rgba(0,0,0,0.12);
      width: 40px; height: 40px;
      display:flex; align-items:center; justify-content:center;
      border-radius:8px;
      cursor:pointer;
      font-weight:700;
    }
    .page-btn:hover { transform: translateY(-3px); box-shadow: 0 8px 18px rgba(0,0,0,0.06); }
    .page-btn.clicked { transform: scale(.98); }
    /* active / glowing page */
    .page-active {
      background: linear-gradient(90deg, rgba(212,175,55,1) 0%, rgba(249,212,35,0.98) 100%);
      color: #000;
      border-color: rgba(212,175,55,0.9);
      box-shadow: 0 6px 30px rgba(212,175,55,0.22), 0 0 18px rgba(212,175,55,0.45);
      transform: translateY(-4px) scale(1.04);
    }

    /* arrow/nav buttons */
    .nav-btn { transition: all .12s ease; display:flex; align-items:center; justify-content:center; width:40px; height:40px; border-radius:8px; border:1px solid rgba(0,0,0,0.08); background:transparent; cursor:pointer; }
    .nav-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 18px rgba(0,0,0,0.06); }
    .nav-btn.clicked { transform: scale(.96); opacity:.95; }

    /* heart styling */
    .heart-btn{ background:rgba(255,255,255,0.85); border-radius:9999px; width:40px; height:40px; display:flex; align-items:center; justify-content:center; }
    .heart-active{ background:var(--gold); color:#000 !important; }

    /* responsive */
    @media (max-width:767px){
      .select-with-icon select{ width:100%; }
    }
  </style>
</head>
<body class="monument">
  <!-- NAV -->
  <nav class="bg-white text-black shadow-md sticky top-0 z-50">
    <div class="container mx-auto px-6 py-3 flex items-center justify-between">
      <div class="flex items-center gap-6 min-w-0">
        <a href="/Home/" class="flex items-center">
          <span class="monument text-2xl" style="font-weight:900; color:var(--black);">Grin & Glisten</span>
        </a>

        <div class="hidden md:flex space-x-8">
          <div class="relative group">
            <button class="flex items-center space-x-1 monument text-black">
              <span>All Products</span>
              <i data-feather="chevron-down" class="w-4 h-4"></i>
            </button>
            <div class="absolute hidden group-hover:block dropdown-menu shadow-lg rounded-md p-4 w-64">
              <div class="grid grid-cols-1 gap-2">
                <a href="/AllProducts/" class="px-2 py-1 hover:bg-gray-100 rounded monument text-black">All Products</a>
                <div class="border-t border-gray-200 my-1"></div>
                <a href="/Grillz/" class="px-2 py-1 hover:bg-gray-100 rounded monument text-black">Grillz</a>
                <a href="/NailJewelry/" class="px-2 py-1 hover:bg-gray-100 rounded monument text-black">Nail Jewelry</a>
                <a href="/Earrings/" class="px-2 py-1 hover:bg-gray-100 rounded monument text-black">Earrings</a>
                <div class="border-t border-gray-200 pt-2 mt-1">
                  <a href="/VEERWEAR/" class="px-2 py-1 hover:bg-gray-100 rounded"><span class="veerwear">Veerwear</span></a>
                </div>
                <div class="border-t border-gray-200 pt-2 mt-1 flex items-center">
                  <a href="/aLvaLemerCh/" class="flex items-center px-2 py-1 hover:bg-gray-100 rounded">
                    <img src="/images/vale-logo-removebg-preview.png" alt="vaLe" class="merch-inline-img">
                    <span class="plunct in-dropdown">aL vaLe merCh</span>
                  </a>
                </div>
              </div>
            </div>
          </div>

          <a href="/HowToOrder/" class="monument hover:text-amber-600 text-black">How to Order</a>
          <a href="/ImpressionKit/" class="monument hover:text-amber-600 text-black">Impression Kit</a>
          <a href="/Gallery/" class="monument hover:text-amber-600 text-black">Gallery</a>
        </div>
      </div>

      <div class="flex items-center gap-4">
        <!-- mobile menu -->
        <button class="md:hidden p-2" id="mobileMenuBtn" aria-expanded="false" aria-controls="mobileNav" title="Open menu">
          <i data-feather="menu" class="text-black"></i>
        </button>

        <!-- search icon (kept as-is) -->
        <a href="#" class="hidden md:inline text-black" aria-label="Search"><i data-feather="search" class="w-5 h-5"></i></a>

        <!-- Header heart icon (NO text) — visible on all breakpoints, same level as search & cart -->
        <a href="/favorites.html" class="text-black flex items-center" id="headerFavorites" aria-label="Favorites">
          <i data-feather="heart" class="w-5 h-5"></i>
        </a>

        <!-- Snipcart-powered cart icon (toggle behavior implemented) -->
        <a href="#" id="headerCartToggle" class="relative snipcart-checkout text-black nav-btn" aria-label="Cart">
          <i data-feather="shopping-bag" class="w-5 h-5"></i>
          <span class="absolute -top-2 -right-2 bg-amber-600 text-black text-xs rounded-full w-5 h-5 flex items-center justify-center bag-count">
            <span class="snipcart-items-count">0</span>
          </span>
        </a>
      </div>
    </div>

    <!-- mobile nav -->
    <div id="mobileNav" class="md:hidden" style="display:none;">
      <div class="flex items-center justify-between mb-4 px-4">
        <div class="flex items-center gap-3">
          <img src="/images/vale-logo-removebg-preview.png" alt="vaLe" class="w-8 h-8 object-contain">
          <span class="monument text-lg" style="font-weight:900; color:var(--black);">Grin & Glisten</span>
        </div>
        <button id="mobileCloseBtn" class="p-2" title="Close menu"><i data-feather="x"></i></button>
      </div>

      <div class="space-y-3 monument px-4">
        <a href="/Home/" class="block py-2 border-b">HOME</a>
        <div class="pt-2 pb-2 border-b">
          <div class="font-medium mb-2">All Products</div>
          <a href="/Grillz/" class="block py-1">Grillz</a>
          <a href="/NailJewelry/" class="block py-1">Nail Jewelry</a>
          <a href="/Earrings/" class="block py-1">Earrings</a>
          <a href="/VEERWEAR/" class="block py-1"><span class="veerwear">Veerwear</span></a>
          <a href="/aLvaLemerCh/" class="block py-1 flex items-center">
            <img src="/images/vale-logo-removebg-preview.png" class="merch-inline-img" alt="vaLe"/>
            <span class="plunct">aL vaLe merCh</span>
          </a>
        </div>

        <a href="/HowToOrder/" class="block py-2 border-b">How to Order</a>
        <a href="/ImpressionKit/" class="block py-2 border-b">Impression Kit</a>
        <a href="/Gallery/" class="block py-2 border-b">Gallery</a>

        <!-- keep a textual Favorites link inside the mobile menu for clarity -->
        <a href="/favorites.html" class="block py-2 border-b">Favorites</a>
      </div>
    </div>
  </nav>

  <!-- HERO (doubled vertical real estate) -->
  <section class="shop-hero text-white">
    <div class="overlay" aria-hidden="true"></div>
    <div class="container mx-auto px-6 hero-inner">
      <div class="shop-banner">
        <div>
          <h1 class="monument text-5xl md:text-6xl mb-4" style="font-weight:900;">Shop All Products</h1>
          <div class="flex items-center text-gray-200 text-sm monument">
            <a href="/Home/" class="hover:text-white text-gray-200">Home</a>
            <i data-feather="chevron-right" class="mx-2 w-4 h-4"></i>
            <span>All Products</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- CONTENT -->
  <section class="py-12">
    <div class="container mx-auto px-6">
      <div class="flex flex-col md:flex-row gap-8">
        <aside class="md:w-1/4">
          <div class="bg-white p-6 rounded-lg filter-panel monument">
            <h3 class="font-medium text-lg mb-4" style="color:var(--black);">Filter By</h3>

            <!-- Category -->
            <div class="filter-section">
              <button class="filter-toggle" data-target="category-body">
                <span style="color:var(--black);">Category</span>
                <i data-feather="chevron-down" class="chev" id="chev-category"></i>
              </button>
              <div id="category-body" class="mt-3">
                <div class="space-y-2">
                  <div class="flex items-center">
                    <input type="checkbox" id="grillz" value="Grillz" class="filter-cat mr-2">
                    <label for="grillz" class="text-sm" style="color:var(--black);">Grillz</label>
                  </div>
                  <div class="flex items-center">
                    <input type="checkbox" id="earrings" value="Earrings" class="filter-cat mr-2">
                    <label for="earrings" class="text-sm" style="color:var(--black);">Earrings</label>
                  </div>
                  <div class="flex items-center">
                    <input type="checkbox" id="nails" value="Nail Jewelry" class="filter-cat mr-2">
                    <label for="nails" class="text-sm" style="color:var(--black);">Nail Jewelry</label>
                  </div>
                  <div class="flex items-center">
                    <input type="checkbox" id="aL_vaLe" value="aL vaLe" class="filter-cat mr-2">
                    <label for="aL_vaLe" class="text-sm"><span class="plunct" style="color:var(--black);">aL vaLe</span></label>
                  </div>
                  <div class="flex items-center">
                    <input type="checkbox" id="veerwear" value="Veerwear" class="filter-cat mr-2">
                    <label for="veerwear" class="text-sm"><span class="veerwear">Veerwear</span></label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Material -->
            <div class="filter-section">
              <button class="filter-toggle" data-target="material-body">
                <span style="color:var(--black);">Material</span>
                <i data-feather="chevron-down" class="chev" id="chev-material"></i>
              </button>
              <div id="material-body" class="mt-3">
                <div class="space-y-2">
                  <div class="flex items-center">
                    <input type="checkbox" id="gold" value="Gold" class="filter-material mr-2">
                    <label for="gold" class="text-sm" style="color:var(--black);">Gold</label>
                  </div>
                  <div class="flex items-center">
                    <input type="checkbox" id="silver" value="Silver" class="filter-material mr-2">
                    <label for="silver" class="text-sm" style="color:var(--black);">Silver</label>
                  </div>
                  <div class="flex items-center">
                    <input type="checkbox" id="platinum" value="Platinum" class="filter-material mr-2">
                    <label for="platinum" class="text-sm" style="color:var(--black);">Platinum</label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Price -->
            <div class="filter-section">
              <button class="filter-toggle" data-target="price-body">
                <span style="color:var(--black);">Price Range</span>
                <i data-feather="chevron-down" class="chev" id="chev-price"></i>
              </button>
              <div id="price-body" class="mt-3">
                <div class="space-y-2">
                  <div class="flex items-center"><input type="radio" id="price-all" name="price" value="all" checked class="filter-price mr-2"><label for="price-all" class="text-sm">All Prices</label></div>
                  <div class="flex items-center"><input type="radio" id="price-1" name="price" value="under200" class="filter-price mr-2"><label for="price-1" class="text-sm">Under $200</label></div>
                  <div class="flex items-center"><input type="radio" id="price-2" name="price" value="200-500" class="filter-price mr-2"><label for="price-2" class="text-sm">$200 - $500</label></div>
                  <div class="flex items-center"><input type="radio" id="price-3" name="price" value="500-1000" class="filter-price mr-2"><label for="price-3" class="text-sm">$500 - $1,000</label></div>
                </div>
              </div>
            </div>

            <button id="applyFiltersBtn" class="w-full bg-amber-600 hover:bg-amber-700 text-black py-2 rounded-md monument">Apply Filters</button>
          </div>
        </aside>

        <main class="md:w-3/4 monument">
          <div class="flex justify-between items-center mb-8">
            <div><span id="showingText" style="color:var(--black);">Showing 0 of 0 products</span></div>

            <div class="flex items-baseline sort-row">
              <span class="mr-2 text-gray-600 text-sm" style="color:var(--black);">Sort by:</span>
              <div class="select-with-icon">
                <i data-feather="chevron-down" class="w-4 h-4"></i>
                <select id="sortSelect" class="text-black rounded-md text-sm">
                  <option value="featured">Featured</option>
                  <option value="price-asc">Price: Low to High</option>
                  <option value="price-desc">Price: High to Low</option>
                  <option value="newest">Newest Arrivals</option>
                  <option value="best-selling">Best Selling</option>
                </select>
              </div>
            </div>
          </div>

          <div id="productGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>

          <div class="flex justify-center mt-12"><nav id="pagination" class="flex items-center space-x-2"></nav></div>
        </main>
      </div>
    </div>
  </section>

  <footer class="py-12">
    <div class="container mx-auto px-6">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <div>
          <h3 class="monument text-xl mb-4" style="font-weight:900;">Grin & Glisten</h3>
          <p class="mb-4">Custom grillz and street jewelry crafted with precision and attitude.</p>
        </div>
        <div>
          <h4 class="monument font-medium mb-4">Shop</h4>
          <ul class="space-y-2">
            <li><a href="/AllProducts/" class="text-sm">All Products</a></li>
            <li><a href="/Grillz/" class="text-sm">Grillz</a></li>
            <li><a href="/NailJewelry/" class="text-sm">Nail Jewelry</a></li>
            <li><a href="/Earrings/" class="text-sm">Earrings</a></li>
          </ul>
        </div>
        <div>
          <h4 class="monument font-medium mb-4">Support</h4>
          <ul class="space-y-2">
            <li><a href="/HowToOrder/" class="text-sm">How to Order</a></li>
            <li><a href="/ImpressionKit/" class="text-sm">Impression Kit</a></li>
          </ul>
        </div>
        <div>
          <h4 class="monument font-medium mb-4">Legal</h4>
          <ul class="space-y-2">
            <li><a href="/TermsandConditions/" class="text-sm">Terms & Conditions</a></li>
          </ul>
        </div>
      </div>
      <div class="border-t mt-12 pt-8 text-center text-sm" style="border-color:#111;">
        <p>© 2025 Grin & Glisten. All rights reserved. <span class="plunct">aL vaLe</span> music subsidiary.</p>
      </div>
    </div>
  </footer>

  <!-- Snipcart root: replace YOUR_SNIPCART_API_KEY with your actual key -->
  <div hidden id="snipcart" data-api-key="YOUR_SNIPCART_API_KEY"></div>

  <script>
    feather.replace();

    // Mobile nav toggle
    const mobileBtn = document.getElementById('mobileMenuBtn');
    const mobileNav = document.getElementById('mobileNav');
    const mobileClose = document.getElementById('mobileCloseBtn');
    mobileBtn?.addEventListener('click', ()=> mobileNav.style.display='block');
    mobileClose?.addEventListener('click', ()=> mobileNav.style.display='none');

    // Filter collapse behavior
    document.querySelectorAll('.filter-toggle').forEach(btn=>{
      const target = document.getElementById(btn.getAttribute('data-target'));
      const chev = btn.querySelector('.chev');
      if(target) target.style.display='block';
      if(chev) chev.classList.add('open');
      btn.addEventListener('click', ()=>{
        if(!target) return;
        const none = getComputedStyle(target).display === 'none';
        target.style.display = none ? 'block' : 'none';
        chev?.classList.toggle('open', none);
      });
    });

    /* --------------------------
       Product data generator + renderer (demo)
       - favorites stored in localStorage key: 'sb_favorites'
       - Snipcart-ready buy buttons added (static site)
       - Pagination glow + click reactions
       - Cart icon toggles Snipcart open/close
    -------------------------- */
    const categories = ['Grillz','Earrings','Nail Jewelry','aL vaLe','Veerwear','Accessories'];
    const materials = ['Gold','Silver','Platinum','With Diamonds','Resin'];
    const products = [];
    const TOTAL_ITEMS = 86;
    function rand(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
    for(let i=1;i<=TOTAL_ITEMS;i++){
      const cat = categories[i % categories.length];
      const mat = materials[i % materials.length];
      const price = (i % 10 === 0) ? rand(1200,3500) : rand(50,1200);
      const sold = rand(0,2000);
      const featured = i % 7 === 0;
      const date = new Date(Date.now() - rand(0,365)*24*3600*1000).toISOString();
      products.push({ id:i, title:`${cat} Item ${i}`, description:`${mat} · ${cat}`, image:`/images/placeholder-${(i%10)+1}.jpg`, price, category:cat, material:mat, soldCount:sold, featured, date });
    }

    // State
    let currentPage = 1;
    const pageSize = 24;
    let currentFilters = { categories:[], materials:[], price:'all' };
    let currentSort = 'featured';

    // favorites - localStorage
    function readFavorites(){
      try{ return new Set(JSON.parse(localStorage.getItem('sb_favorites')||'[]')); }catch(e){ return new Set(); }
    }
    function writeFavorites(set){
      const arr = Array.from(set);
      localStorage.setItem('sb_favorites', JSON.stringify(arr));
    }
    function toggleFavorite(id){
      const s = readFavorites();
      if(s.has(id)){ s.delete(id); } else { s.add(id); }
      writeFavorites(s);
      renderProducts(); // re-render to update heart state
    }

    function priceMatch(price, filterKey){
      if(!filterKey||filterKey==='all') return true;
      if(filterKey==='under200') return price < 200;
      if(filterKey==='200-500') return price >=200 && price <=500;
      if(filterKey==='500-1000') return price >500 && price <=1000;
      if(filterKey==='over1000') return price >1000;
      return true;
    }

    function applyFiltersAndSort(){
      let out = products.slice();
      if(currentFilters.categories.length) out = out.filter(p => currentFilters.categories.includes(p.category));
      if(currentFilters.materials.length) out = out.filter(p => currentFilters.materials.includes(p.material));
      if(currentFilters.price && currentFilters.price !== 'all') out = out.filter(p => priceMatch(p.price, currentFilters.price));
      if(currentSort==='price-asc') out.sort((a,b)=>a.price-b.price);
      else if(currentSort==='price-desc') out.sort((a,b)=>b.price-a.price);
      else if(currentSort==='newest') out.sort((a,b)=>new Date(b.date)-new Date(a.date));
      else if(currentSort==='best-selling') out.sort((a,b)=>b.soldCount-a.soldCount);
      else out.sort((a,b)=> (b.featured?1:0) - (a.featured?1:0));
      return out;
    }

    function renderProducts(){
      const grid = document.getElementById('productGrid');
      grid.innerHTML = '';
      const filtered = applyFiltersAndSort();
      const total = filtered.length;
      const start = (currentPage-1)*pageSize;
      const pageItems = filtered.slice(start, start + pageSize);
      document.getElementById('showingText').textContent = `Showing ${pageItems.length} of ${total} products`;

      const favSet = readFavorites();

      for(const p of pageItems){
        let fontClass = 'monument';
        if(p.category==='Veerwear') fontClass='veerwear';
        else if(p.category==='aL vaLe') fontClass='plunct';
        const heartActive = favSet.has(p.id);

        const card = document.createElement('div');
        card.className = 'bg-white rounded-lg overflow-hidden product-card';
        card.innerHTML = `
          <div class="relative overflow-hidden h-64">
            <img src="${p.image}" alt="${p.title}" class="w-full h-full object-cover">
            <div class="absolute inset-0 bg-gradient-to-t from-black/30 to-transparent"></div>
            ${p.featured ? `<div class="absolute top-3 left-3 badge-gold">BESTSELLER</div>` : ''}
            <button class="absolute top-3 right-3 heart-btn ${heartActive ? 'heart-active' : ''}" data-id="${p.id}" title="Save to favorites">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 ${heartActive ? '' : ''}" viewBox="0 0 24 24" fill="${heartActive ? 'currentColor' : 'none'}" stroke="currentColor" stroke-width="1.5"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"/></svg>
            </button>
          </div>
          <div class="p-4">
            <h3 class="font-medium mb-1 ${fontClass}" style="color:var(--black);">${p.title}</h3>
            <p class="${fontClass} text-gray-600 text-sm mb-2" style="color:var(--black);">${p.description}</p>
            <div class="flex justify-between items-center">
              <span class="${fontClass} font-bold" style="color:var(--black);">$${p.price.toLocaleString()}</span>

              <!-- Snipcart add-to-cart button -->
              <button class="snipcart-add-item inline-flex items-center px-3 py-2 rounded text-sm border border-transparent bg-amber-600 hover:bg-amber-700"
                data-item-id="${p.id}"
                data-item-name="${p.title}"
                data-item-price="${p.price}"
                data-item-url="/AllProducts/"
                data-item-description="${p.description}"
                data-item-image="${p.image}">
                Add to cart
              </button>
            </div>
          </div>
        `;
        grid.appendChild(card);
      }

      // bind heart toggles
      document.querySelectorAll('.heart-btn').forEach(btn=>{
        btn.addEventListener('click', (e)=>{
          const id = Number(btn.getAttribute('data-id'));
          toggleFavorite(id);
        });
      });

      feather.replace();
      renderPagination(filtered.length);
    }

    function renderPagination(totalFiltered){
      const pagination = document.getElementById('pagination'); pagination.innerHTML='';
      const totalPages = Math.max(1, Math.ceil(totalFiltered / pageSize));

      // helper to create nav button (arrow)
      function makeNavButton(iconName, onClick, disabled=false){
        const b = document.createElement('button');
        b.className = 'nav-btn';
        if(disabled) b.setAttribute('disabled','true');
        b.innerHTML = `<i data-feather="${iconName}" class="w-4 h-4"></i>`;
        b.addEventListener('click', (e)=>{ if(disabled) return; b.classList.add('clicked'); setTimeout(()=>b.classList.remove('clicked'),140); onClick(e); });
        pagination.appendChild(b);
        return b;
      }

      // prev
      makeNavButton('chevron-left', ()=>{
        if(currentPage > 1){ currentPage--; renderProducts(); }
      }, currentPage === 1);

      function pageBtn(page){
        const b = document.createElement('button');
        b.className = 'page-btn';
        b.textContent = String(page);
        if(page === currentPage) b.classList.add('page-active');
        b.addEventListener('click', ()=>{
          if(page === currentPage) {
            // small press feedback if clicking the active page
            b.classList.add('clicked');
            setTimeout(()=>b.classList.remove('clicked'),120);
            return;
          }
          b.classList.add('clicked');
          setTimeout(()=>b.classList.remove('clicked'),120);
          currentPage = page;
          renderProducts();
        });
        // press feedback for touch/mouse
        ['mousedown','touchstart'].forEach(ev => b.addEventListener(ev, ()=> b.classList.add('clicked')));
        ['mouseup','mouseleave','touchend','touchcancel'].forEach(ev => b.addEventListener(ev, ()=> b.classList.remove('clicked')));
        pagination.appendChild(b);
      }

      if(totalPages <= 8){
        for(let p=1;p<=totalPages;p++) pageBtn(p);
      } else {
        pageBtn(1);
        pageBtn(2);
        if(currentPage > 4){
          const dots = document.createElement('span'); dots.className='px-2'; dots.textContent='...'; pagination.appendChild(dots);
        }
        const start = Math.max(3, Math.min(currentPage-1, totalPages-4));
        const end = Math.min(totalPages-2, start + 2);
        for(let p=start;p<=end;p++) pageBtn(p);
        if(end < totalPages-2){
          const dots2 = document.createElement('span'); dots2.className='px-2'; dots2.textContent='...'; pagination.appendChild(dots2);
        }
        pageBtn(totalPages-1);
        pageBtn(totalPages);
      }

      // next
      makeNavButton('chevron-right', ()=>{
        if(currentPage < Math.ceil(totalFiltered / pageSize)){ currentPage++; renderProducts(); }
      }, currentPage === Math.ceil(totalFiltered / pageSize));

      // feather icons need to be replaced after adding buttons
      feather.replace();
    }

    function readFiltersFromUI(){
      currentFilters.categories = Array.from(document.querySelectorAll('.filter-cat:checked')).map(i=>i.value);
      currentFilters.materials = Array.from(document.querySelectorAll('.filter-material:checked')).map(i=>i.value);
      const priceRadio = document.querySelector('.filter-price:checked');
      currentFilters.price = priceRadio ? priceRadio.value : 'all';
    }

    document.getElementById('applyFiltersBtn').addEventListener('click', ()=>{ readFiltersFromUI(); currentPage = 1; renderProducts(); });
    document.getElementById('sortSelect').addEventListener('change', e => { currentSort = e.target.value; currentPage = 1; renderProducts(); });

    /* --------------------------
       Cart toggle behavior
       - Uses Snipcart events if Snipcart is present.
       - Clicking the cart icon toggles open/close.
    -------------------------- */
    const headerCartToggle = document.getElementById('headerCartToggle');
    let cartOpen = false;
    // Listen to Snipcart events to keep cartOpen in sync when Snipcart opens/closes
    document.addEventListener('snipcart.ready', ()=>{ cartOpen = false; });
    document.addEventListener('snipcart.opened', ()=>{ cartOpen = true; });
    document.addEventListener('snipcart.closed', ()=>{ cartOpen = false; });

    headerCartToggle?.addEventListener('click', (e)=>{
      e.preventDefault();
      // provide quick visual feedback
      headerCartToggle.classList.add('clicked');
      setTimeout(()=> headerCartToggle.classList.remove('clicked'), 140);

      if(window.Snipcart && window.Snipcart.api && window.Snipcart.api.modal){
        if(cartOpen) window.Snipcart.api.modal.close();
        else window.Snipcart.api.modal.open();
        // Snipcart events will flip cartOpen accordingly.
      } else {
        // Snipcart not ready yet — attempt to open via the built-in checkout trigger
        // The built-in behavior would be to follow the anchor with class "snipcart-checkout".
        // We already prevented default; do a best-effort fallback:
        const anchor = document.querySelector('a.snipcart-checkout');
        if(anchor){
          anchor.click();
        } else {
          console.warn('Snipcart not initialized yet.');
        }
      }
    });

    // initial render
    document.addEventListener('DOMContentLoaded', ()=>{
      feather.replace();
      readFiltersFromUI();
      currentSort = document.getElementById('sortSelect').value || 'featured';
      renderProducts();
    });
  </script>
</body>
</html>
