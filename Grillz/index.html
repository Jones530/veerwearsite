<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Grin & Glisten â€” CATEGORY_NAME</title>
  <link rel="icon" type="image/x-icon" href="/static/favicon.ico">

  <!-- Google font preload -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pirata+One&display=swap" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Feather icons -->
  <script src="https://unpkg.com/feather-icons"></script>

  <!-- Snipcart -->
  <link rel="stylesheet" href="https://cdn.snipcart.com/themes/v3.3.0/default/snipcart.css" />
  <script async src="https://cdn.snipcart.com/themes/v3.3.0/default/snipcart.js"></script>

  <style>
    /* ---------- fonts, variables and base ---------- */
    @font-face { font-family: "Monument Extended"; src: url("/fonts/MonumentExtended-FreeForPersonalUse/MonumentExtended-Regular.woff2") format("woff2"), url("/fonts/MonumentExtended-FreeForPersonalUse/MonumentExtended-Regular.ttf") format("truetype"); font-weight:400; font-style:normal; font-display:swap; }
    @font-face { font-family: "Monument Extended Ultrabold"; src: url("/fonts/MonumentExtended-FreeForPersonalUse/MonumentExtended-Ultrabold.otf") format("opentype"); font-weight:900; font-style:normal; font-display:swap; }
    @font-face { font-family: "Plunct"; src: url("/fonts/Plunct(1).woff2") format("woff2"); font-weight:400 800; font-style:normal; font-display:swap; }
    @font-face { font-family: 'Pirata One'; src: url('/fonts/PirataOne-Regular.ttf') format('truetype'); font-weight:400; font-style:normal; font-display:swap; }

    :root { --gold:#D4AF37; --gold-dark:#B58826; --black:#000; --white:#fff; --veer-deep:#B30000; }

    html{ font-size:112.5%; }
    html,body{ font-family:"Pirata One","Monument Extended",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif; margin:0; color:var(--black); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }

    .plunct{ font-family:"Plunct","Pirata One","Monument Extended",sans-serif; font-weight:700; }
    .veerwear{ font-family:"Monument Extended Ultrabold","Monument Extended","Pirata One",sans-serif; color:var(--veer-deep); font-weight:900; text-transform:uppercase; letter-spacing:0.6px; }
    .monument{ font-family:"Monument Extended","Pirata One",sans-serif; font-weight:700; }

    .bag-count{ font-family:"Monument Extended Ultrabold","Monument Extended",sans-serif; font-weight:900; font-size:11px; line-height:1; }

    /* ---- select-with-icon: hide native arrow and position custom icon ---- */
    .select-with-icon { position: relative; display: inline-flex; align-items:center; vertical-align:middle; }
    .select-with-icon i, .select-with-icon svg { position:absolute; right:12px; top:50%; transform:translateY(-50%); pointer-events:none; z-index:2; width:18px; height:18px; display:block; }
    .select-with-icon select { -webkit-appearance:none; -moz-appearance:none; appearance:none; background-image:none; padding-left:12px; padding-right:44px; height:38px; line-height:1; border-radius:6px; border:1px solid var(--black); color:var(--black); background:white; z-index:1; }

    /* Hero (uses same .shop-hero styles as All Products) */
    .shop-hero {
      position: relative;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      color:#fff;
      overflow:visible;
      padding-top:8rem;
      padding-bottom:8rem;
      min-height:60vh;
      display:flex;
      align-items:center;
    }
    .shop-hero .overlay{ position:absolute; inset:0; background:rgba(0,0,0,0.35); pointer-events:none; }
    .shop-hero .hero-inner{ position:relative; z-index:2; }

    /* small curated-grid styling (similar to product grid) */
    .curated-grid { display:grid; grid-template-columns: repeat(3,1fr); gap:1rem; }
    @media (max-width:1024px){ .curated-grid { grid-template-columns: repeat(2,1fr); } }
    @media (max-width:640px){ .curated-grid { grid-template-columns: 1fr; } }

    .fav-item { display:flex; gap:12px; border-bottom:1px solid #eee; padding:12px 0; align-items:center; }

    /* keep product card visuals consistent with All Products */
    .product-card{ border:1px solid rgba(0,0,0,0.06); box-shadow:0 6px 18px rgba(0,0,0,0.06); transition:transform .18s ease, box-shadow .18s ease; background:#fff; border-radius:8px; overflow:hidden; }
    .product-card:hover{ transform:translateY(-6px); box-shadow:0 14px 30px rgba(0,0,0,0.08); }

    /* one-click view all button style */
    .btn-view-all { display:inline-flex; align-items:center; gap:8px; background:var(--gold); color:#000; padding:10px 14px; border-radius:8px; font-weight:700; text-decoration:none; }

  </style>
</head>
<body class="monument">
  <!-- NAV (verbatim copy from your AllProducts file; DO NOT MODIFY) -->
  <nav class="bg-white text-black shadow-md sticky top-0 z-50">
    <div class="container mx-auto px-6 py-3 flex items-center justify-between">
      <div class="flex items-center gap-6 min-w-0">
        <!-- Mobile hamburger (visible < md) -->
        <button id="mobileMenuBtn" aria-label="Open menu" class="md:hidden">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><path d="M3 7h18M3 12h18M3 17h18"></path></svg>
        </button>

        <a href="/Home/" class="flex items-center">
          <span class="monument text-2xl" style="font-weight:900; color:var(--black);">Grin & Glisten</span>
        </a>

        <div class="hidden md:flex space-x-8">
          <div class="group" id="all-products-group">
            <!-- trigger -->
            <button class="menu-trigger monument text-black" aria-expanded="false" aria-haspopup="true" id="allProductsTrigger">
              <span class="menu-label">All Products</span>
              <i data-feather="chevron-down" class="w-4 h-4"></i>
            </button>

            <!-- dropdown menu (white backing, auto width) -->
            <div class="dropdown-menu rounded-md" role="menu" aria-hidden="true" id="allProductsMenu">
              <div class="grid grid-cols-1 gap-0">
                <a href="/AllProducts/" class="monument">All Products</a>
                <div style="height:1px;background:#eee;margin:4px 0;"></div>
                <a href="/Grillz/" class="monument">Grillz</a>
                <a href="/NailJewelry/" class="monument">Nail Jewelry</a>
                <a href="/Earrings/" class="monument">Earrings</a>
                <div style="height:1px;background:#eee;margin:6px 0;"></div>
                <a href="/VEERWEAR/" class="veerwear">Veerwear</a>
                <div style="height:1px;background:#eee;margin:6px 0;"></div>
                <a href="/aLvaLemerCh/" class="flex items-center pl-0">
                  <img src="/images/vale-logo-removebg-preview.png" alt="vaLe" class="merch-inline-img">
                  <span class="plunct">aL vaLe merCh</span>
                </a>
              </div>
            </div>
          </div>

          <a href="/HowToOrder/" class="monument hover:text-amber-600 text-black">How to Order</a>
          <a href="/ImpressionKit/" class="monument hover:text-amber-600 text-black">Impression Kit</a>
          <a href="/Gallery/" class="monument hover:text-amber-600 text-black">Gallery</a>
        </div>
      </div>

      <!-- header icons: search, heart, cart -->
      <div class="header-actions">
        <!-- SEARCH WRAP: desktop expands left. On mobile the icon will open mobile nav & focus mobile search. -->
        <div class="search-wrap" id="desktopSearchWrap" aria-hidden="false">
          <form id="headerSearchForm" class="search-form" role="search" action="/search.html" method="get">
            <input id="headerSearchInput" name="q" type="search" class="search-input" placeholder="Search products..." aria-label="Search products">
            <!-- search button: when collapsed clicking it opens input; when open form submit -->
            <button id="headerSearchBtn" type="submit" class="search-btn" aria-label="Search">
              <i data-feather="search" class="w-4 h-4"></i>
            </button>
          </form>
        </div>

        <a href="/favorites.html" class="text-black flex items-center justify-center" id="headerFavorites" aria-label="Favorites">
          <i data-feather="heart" class="w-5 h-5"></i>
        </a>

        <a href="#" id="headerCartToggle" class="relative snipcart-checkout text-black nav-btn" aria-label="Cart">
          <i data-feather="shopping-bag" class="w-5 h-5"></i>
          <span class="absolute -top-2 -right-2 bg-amber-600 text-black text-xs rounded-full w-5 h-5 flex items-center justify-center bag-count">
            <span class="snipcart-items-count">0</span>
          </span>
        </a>
      </div>
    </div>

    <!-- mobile nav -->
    <div id="mobileNav" class="md:hidden" style="display:none;">
      <div class="flex items-center justify-between mb-4 px-4">
        <div class="flex items-center gap-3">
          <img src="/images/vale-logo-removebg-preview.png" alt="vaLe" class="w-8 h-8 object-contain">
          <span class="monument text-lg" style="font-weight:900; color:var(--black);">Grin & Glisten</span>
        </div>
        <button id="mobileCloseBtn" class="p-2" title="Close menu"><i data-feather="x"></i></button>
      </div>

      <!-- Mobile search area (toggled by header search icon on small screens) -->
      <div id="mobileSearchBar" aria-hidden="true">
        <form id="mobileSearchForm" action="/search.html" method="get" role="search">
          <input id="mobileSearchInput" name="q" type="search" placeholder="Search products..." aria-label="Search products">
          <button type="submit" class="bg-amber-600 text-black px-3 py-2 rounded monument">Search</button>
        </form>
      </div>

      <div class="space-y-3 monument px-4">
        <a href="/Home/" class="block py-2 border-b">HOME</a>
        <div class="pt-2 pb-2 border-b">
          <div class="font-medium mb-2">All Products</div>
          <a href="/Grillz/" class="block py-1">Grillz</a>
          <a href="/NailJewelry/" class="block py-1">Nail Jewelry</a>
          <a href="/Earrings/" class="block py-1">Earrings</a>
          <a href="/VEERWEAR/" class="block py-1"><span class="veerwear">Veerwear</span></a>
          <a href="/aLvaLemerCh/" class="block py-1 flex items-center">
            <img src="/images/vale-logo-removebg-preview.png" class="merch-inline-img" alt="vaLe"/>
            <span class="plunct">aL vaLe merCh</span>
          </a>
        </div>

        <a href="/HowToOrder/" class="block py-2 border-b">How to Order</a>
        <a href="/ImpressionKit/" class="block py-2 border-b">Impression Kit</a>
        <a href="/Gallery/" class="block py-2 border-b">Gallery</a>

        <!-- mobile favorites link -->
        <a href="/favorites.html" class="block py-2 border-b">Favorites</a>
      </div>
    </div>
  </nav>

  <!-- HERO â€” replace BANNER_URL, CATEGORY_NAME and CATEGORY_TAGLINE below -->
  <!-- ---------- EDIT THESE VALUES FOR EACH CATEGORY PAGE ---------- -->
  <script>
    // EDIT THESE constants for each category page:
    const BANNER_URL = '/images/placeholder-hero.gif'; // <-- update to the GIF for this category (absolute path)
    const CATEGORY_NAME = 'CATEGORY_NAME';             // <-- e.g. 'Earrings'
    const CATEGORY_SLUG = 'CATEGORY_SLUG';             // <-- exact filter string used by AllProducts (e.g. 'Earrings' or 'Veerwear')
    const CATEGORY_TAGLINE = 'CATEGORY_TAGLINE';       // <-- short, 1-line tagline
    // CURATED_IDS: array of numeric product ids that match your products array on AllProducts.
    // e.g. [3,7,12,24,36,42]
    const CURATED_IDS = [1,2,3,4,5,6];                 // <-- replace with the product IDs you want shown
    // SUBTYPES: optional array of { name, query } where query is appended to /AllProducts/ to prefilter.
    // e.g. { name: 'Hoops', query: 'style=hoops' } will link to /AllProducts/?category=Earrings&style=hoops
    const SUBTYPES = [
      { name: 'Hoops', query: 'style=hoops' },
      { name: 'Studs', query: 'style=studs' },
      { name: 'Drops', query: 'style=drops' }
    ];
  </script>
  <section class="shop-hero text-white" id="categoryHero" style="background-image: url('/images/placeholder-hero.gif');">
    <div class="overlay" aria-hidden="true"></div>
    <div class="container mx-auto px-6 hero-inner">
      <div class="shop-banner">
        <div>
          <h1 id="categoryTitle" class="monument text-5xl md:text-6xl mb-4" style="font-weight:900;">CATEGORY_NAME</h1>
          <div class="flex items-center text-gray-200 text-sm monument">
            <a href="/Home/" class="hover:text-white text-gray-200">Home</a>
            <i data-feather="chevron-right" class="mx-2 w-4 h-4"></i>
            <span id="categoryBreadcrumb">CATEGORY_NAME</span>
          </div>
          <p id="categoryTagline" class="mt-4 text-lg opacity-90">CATEGORY_TAGLINE</p>
          <div class="mt-6">
            <a id="viewAllBtn" class="btn-view-all" href="/AllProducts/?category=CATEGORY_SLUG">View all CATEGORY_NAME</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- CONTENT: curated landing page -->
  <section class="py-12">
    <div class="container mx-auto px-6">
      <div class="flex flex-col md:flex-row gap-8">
        <!-- left column: quick links & subtypes -->
        <aside class="md:w-1/4">
          <div class="bg-white p-6 rounded-lg filter-panel monument">
            <h3 class="font-medium text-lg mb-4" style="color:var(--black);">Explore</h3>
            <div class="space-y-3">
              <a id="linkViewAll" href="/AllProducts/?category=CATEGORY_SLUG" class="block py-2 px-3 border rounded-md text-sm monument">View all CATEGORY_NAME</a>

              <div class="mt-4">
                <h4 class="monument font-medium mb-2">By style</h4>
                <div id="subtypeLinks" class="space-y-2"></div>
              </div>

              <div class="mt-6">
                <h4 class="monument font-medium mb-2">Quick info</h4>
                <p class="text-sm">Handcrafted pieces â€” care & sizing info on each product page. Free shipping over $150.</p>
              </div>
            </div>
          </div>
        </aside>

        <!-- main curated grid -->
        <main class="md:w-3/4 monument">
          <div class="flex justify-between items-center mb-6">
            <div>
              <h2 class="text-2xl font-bold" id="featuredTitle">Featured CATEGORY_NAME</h2>
              <p class="text-sm text-gray-600 mt-1" id="featuredSubtitle">Hand-picked pieces & bestsellers.</p>
            </div>
            <div>
              <a id="viewAllTop" href="/AllProducts/?category=CATEGORY_SLUG" class="btn-view-all">View all CATEGORY_NAME</a>
            </div>
          </div>

          <div id="curatedGrid" class="curated-grid"></div>

          <!-- optional: a small 'more from category' area linking to allProducts -->
          <div class="mt-8 text-center">
            <a id="viewAllBottom" href="/AllProducts/?category=CATEGORY_SLUG" class="btn-view-all">See every CATEGORY_NAME item</a>
          </div>
        </main>
      </div>
    </div>
  </section>

  <!-- FOOTER (verbatim copy from AllProducts; DO NOT MODIFY) -->
  <footer class="py-12">
    <div class="container mx-auto px-6">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <div>
          <h3 class="monument text-xl mb-4" style="font-weight:900;">Grin & Glisten</h3>
          <p class="mb-4">Custom grillz and street jewelry crafted with precision and attitude.</p>
        </div>
        <div>
          <h4 class="monument font-medium mb-4">Shop</h4>
          <ul class="space-y-2">
            <li><a href="/AllProducts/" class="text-sm">All Products</a></li>
            <li><a href="/Grillz/" class="text-sm">Grillz</a></li>
            <li><a href="/NailJewelry/" class="text-sm">Nail Jewelry</a></li>
            <li><a href="/Earrings/" class="text-sm">Earrings</a></li>
            <li><a href="/VEERWEAR/" class="veerwear text-sm">Veerwear</a></li>
            <li><a href="/aLvaLemerCh/" class="plunct text-sm">aL vaLe</a></li>
          </ul>
        </div>
        <div>
          <h4 class="monument font-medium mb-4">Support</h4>
          <ul class="space-y-2">
            <li><a href="/HowToOrder/" class="text-sm">How to Order</a></li>
            <li><a href="/ImpressionKit/" class="text-sm">Impression Kit</a></li>
          </ul>
        </div>
        <div>
          <h4 class="monument font-medium mb-4">Legal</h4>
          <ul class="space-y-2">
            <li><a href="/TermsandConditions/" class="text-sm">Terms & Conditions</a></li>
          </ul>
        </div>
      </div>
      <div class="border-t mt-12 pt-8 text-center text-sm" style="border-color:#111;">
        <p>Â© 2025 Grin & Glisten. All rights reserved. <span class="plunct">aL vaLe</span> music subsidiary.</p>
      </div>
    </div>
  </footer>

  <!-- Snipcart root -->
  <div hidden id="snipcart" data-api-key="YOUR_SNIPCART_API_KEY"></div>

  <!-- SCRIPTS: dropdowns, search, cart toggle, etc. (kept from AllProducts with a single change: we call renderCuratedProducts()) -->
  <script>
    feather.replace();

    // Mobile nav toggle
    const mobileBtn = document.getElementById('mobileMenuBtn');
    const mobileNav = document.getElementById('mobileNav');
    const mobileClose = document.getElementById('mobileCloseBtn');
    mobileBtn?.addEventListener('click', ()=> {
      mobileNav.style.display='block';
      document.body.classList.remove('mobile-search-open'); // don't auto-open mobile search here
    });
    mobileClose?.addEventListener('click', ()=> {
      mobileNav.style.display='none';
      // also clear mobile search
      const mIn = document.getElementById('mobileSearchInput');
      if(mIn) mIn.value = '';
      document.body.classList.remove('mobile-search-open');
    });

    // Filter collapse behavior (chevrons to the right)
    document.querySelectorAll('.filter-toggle').forEach(btn=>{
      const target = document.getElementById(btn.getAttribute('data-target'));
      const chev = btn.querySelector('.chev');
      if(target) target.style.display='block';
      if(chev) chev.classList.add('open');
      btn.addEventListener('click', ()=>{
        if(!target) return;
        const none = getComputedStyle(target).display === 'none';
        target.style.display = none ? 'block' : 'none';
        chev?.classList.toggle('open', none);
      });
    });

    /* --------------------------
       Dropdown: attach menu to body (fixed) and robust open/close
    -------------------------- */
    function positionAndBindDropdowns(){
      document.querySelectorAll('.group').forEach(group=>{
        if(group.dataset.dropdownBound === "true") return;
        const label = group.querySelector('.menu-label');
        const menu = group.querySelector('.dropdown-menu');
        const trigger = group.querySelector('.menu-trigger');

        if(!menu || !label || !trigger) return;

        if (!menu.dataset.moved) {
          document.body.appendChild(menu);
          menu.dataset.moved = "true";
          menu.style.position = 'fixed';
          menu.style.willChange = 'top, left, width';
          menu.style.zIndex = 9999;
        }

        function positionMenu(){
          const prevDisplay = menu.style.display;
          const prevVisibility = menu.style.visibility;
          const prevLeft = menu.style.left;
          const prevTop = menu.style.top;
          const prevWidth = menu.style.width;

          menu.style.display = 'block';
          menu.style.visibility = 'hidden';
          menu.style.left = '-9999px';
          menu.style.top = '-9999px';
          menu.style.width = 'auto';
          menu.style.whiteSpace = 'nowrap';

          let maxItemWidth = 0;
          menu.querySelectorAll('a').forEach(a=>{
            const w = a.scrollWidth;
            if(w > maxItemWidth) maxItemWidth = w;
          });

          const cs = getComputedStyle(menu);
          const padLeft = parseFloat(cs.paddingLeft) || 10;
          const padRight = parseFloat(cs.paddingRight) || 10;
          const extraBuffer = 16;
          const finalWidth = Math.ceil(maxItemWidth + padLeft + padRight + extraBuffer);
          menu.style.width = finalWidth + 'px';

          const labelRect = label.getBoundingClientRect();
          const triggerRect = trigger.getBoundingClientRect();
          const left = Math.round(labelRect.left - padLeft);
          const top = Math.round(triggerRect.bottom + 8);
          const clampedLeft = Math.max(8, left);
          menu.style.left = clampedLeft + 'px';
          menu.style.top = top + 'px';

          menu.style.visibility = '';
          menu.style.display = group.classList.contains('open') ? 'block' : 'none';
        }

        let leaveTimer = null;
        const openMenu = ()=> {
          clearTimeout(leaveTimer);
          group.classList.add('open');
          menu.classList.add('open');
          menu.style.display = 'block';
          trigger.setAttribute('aria-expanded','true');
          menu.setAttribute('aria-hidden','false');
          positionMenu();
        };
        const closeMenu = ()=> {
          clearTimeout(leaveTimer);
          leaveTimer = setTimeout(()=> {
            group.classList.remove('open');
            menu.classList.remove('open');
            menu.style.display = 'none';
            trigger.setAttribute('aria-expanded','false');
            menu.setAttribute('aria-hidden','true');
          }, 120);
        };

        group.addEventListener('pointerenter', openMenu);
        group.addEventListener('pointerleave', closeMenu);
        menu.addEventListener('pointerenter', openMenu);
        menu.addEventListener('pointerleave', closeMenu);

        trigger.addEventListener('focus', openMenu);
        trigger.addEventListener('blur', ()=>{
          leaveTimer = setTimeout(()=> {
            const active = document.activeElement;
            if(menu.contains(active)) return;
            closeMenu();
          }, 120);
        });

        trigger.addEventListener('click', (e)=>{
          e.preventDefault();
          e.stopPropagation();
          if(group.classList.contains('open')) {
            closeMenu();
          } else {
            openMenu();
          }
        });

        const outsideHandler = (ev) => {
          if (!trigger.contains(ev.target) && !menu.contains(ev.target)) {
            closeMenu();
          }
        };
        document.addEventListener('click', outsideHandler);

        const repositionOnResize = () => { if (group.classList.contains('open')) positionMenu(); };
        window.addEventListener('resize', repositionOnResize);
        window.addEventListener('scroll', repositionOnResize, { passive: true });

        document.addEventListener('keydown', (ev)=> {
          if(ev.key === 'Escape') closeMenu();
        });

        group.dataset.dropdownBound = "true";
      });
    }

    window.addEventListener('resize', ()=> positionAndBindDropdowns());
    document.addEventListener('DOMContentLoaded', ()=>{
      feather.replace();
      positionAndBindDropdowns();

      // IMPORTANT: we DON'T render the full AllProducts grid here.
      // Instead we initialize category page UI and render curated items:
      initCategoryHeroAndLinks();
      renderCuratedProducts();

      // init search interactions
      initHeaderSearch();
      initMobileSearch();
    });

    /* --------------------------
       SEARCH UI & mobile search (kept from AllProducts)
    -------------------------- */
    function initHeaderSearch(){
      const wrap = document.getElementById('desktopSearchWrap');
      const form = document.getElementById('headerSearchForm');
      const input = document.getElementById('headerSearchInput');
      const btn = document.getElementById('headerSearchBtn');

      if(!wrap || !form || !input || !btn) return;
      function isMobile() { return window.matchMedia('(max-width:767px)').matches; }

      btn.addEventListener('click', (ev) => {
        if (isMobile()) {
          openMobileSearchAndFocus();
          ev.preventDefault();
          return;
        }
        const isOpen = wrap.classList.contains('open');
        if(!isOpen) {
          ev.preventDefault();
          wrap.classList.add('open');
          setTimeout(()=> input.focus(), 80);
          return;
        }
      });

      form.addEventListener('submit', (ev) => {
        ev.preventDefault();
        const q = (input.value || '').trim();
        if(!q) {
          wrap.classList.remove('open');
          input.value = '';
          return;
        }
        wrap.classList.remove('open');
        const valueToSend = q;
        input.value = '';
        setTimeout(()=> {
          window.location.href = '/search.html?q=' + encodeURIComponent(valueToSend);
        }, 40);
      });

      document.addEventListener('click', (ev) => {
        if(!wrap.contains(ev.target)) {
          wrap.classList.remove('open');
          input.value = '';
        }
      });

      document.addEventListener('keydown', (ev) => {
        if(ev.key === 'Escape') {
          wrap.classList.remove('open');
          input.value = '';
        }
      });
    }

    function initMobileSearch(){
      const mobileForm = document.getElementById('mobileSearchForm');
      const mobileInput = document.getElementById('mobileSearchInput');

      if(mobileForm){
        mobileForm.addEventListener('submit', (ev)=>{
          ev.preventDefault();
          const q = (mobileInput.value || '').trim();
          if(!q) return;
          mobileNav.style.display = 'none';
          document.body.classList.remove('mobile-search-open');
          mobileInput.value = '';
          setTimeout(()=> {
            window.location.href = '/search.html?q=' + encodeURIComponent(q);
          }, 60);
        });
      }
    }

    function openMobileSearchAndFocus(){
      const mobileSearchBar = document.getElementById('mobileSearchBar');
      const mobileInput = document.getElementById('mobileSearchInput');
      if(mobileNav.style.display === 'none' || mobileNav.style.display === '') {
        mobileNav.style.display = 'block';
      }
      document.body.classList.add('mobile-search-open');
      setTimeout(()=> {
        if(mobileInput) mobileInput.focus();
      }, 60);
    }

    /* --------------------------
       Cart toggle behavior (kept)
    -------------------------- */
    const headerCartToggle = document.getElementById('headerCartToggle');
    let cartOpen = false;
    document.addEventListener('snipcart.ready', ()=>{ cartOpen = false; });
    document.addEventListener('snipcart.opened', ()=>{ cartOpen = true; });
    document.addEventListener('snipcart.closed', ()=>{ cartOpen = false; });

    headerCartToggle?.addEventListener('click', (e)=>{
      e.preventDefault();
      headerCartToggle.classList.add('clicked');
      setTimeout(()=> headerCartToggle.classList.remove('clicked'), 140);

      if(window.Snipcart && window.Snipcart.api && window.Snipcart.api.modal){
        if(cartOpen) window.Snipcart.api.modal.close();
        else window.Snipcart.api.modal.open();
      } else {
        const anchor = document.querySelector('a.snipcart-checkout');
        if(anchor){ anchor.click(); } else { console.warn('Snipcart not initialized yet.'); }
      }
    });

    /* --------------------------
       FAVORITES (localStorage) small helper for this page
    -------------------------- */
    function readFavorites(){ try{ return new Set(JSON.parse(localStorage.getItem('sb_favorites')||'[]')); }catch(e){ return new Set(); } }
    function writeFavorites(set){ const arr = Array.from(set); localStorage.setItem('sb_favorites', JSON.stringify(arr)); }

    function toggleFavoriteById(id){
      const s = readFavorites();
      if(s.has(id)) s.delete(id); else s.add(id);
      writeFavorites(s);
      // update curated rendering
      renderCuratedProducts();
    }

    /* --------------------------
       Category page helpers: init hero, subtype links, curated render
       - Uses the global `products` array (from AllProducts generator) if present.
       - If you use an external /js/products.js that exposes window.PRODUCTS keyed by SKU,
         you can adapt CURATED_IDS to use SKUs and enable that block below.
    -------------------------- */
    function initCategoryHeroAndLinks(){
      // set background, title and tagline
      const hero = document.getElementById('categoryHero');
      if(hero && typeof BANNER_URL === 'string') hero.style.backgroundImage = `url('${BANNER_URL}')`;
      const title = document.getElementById('categoryTitle'); if(title) title.textContent = CATEGORY_NAME;
      const breadcrumb = document.getElementById('categoryBreadcrumb'); if(breadcrumb) breadcrumb.textContent = CATEGORY_NAME;
      const tagline = document.getElementById('categoryTagline'); if(tagline) tagline.textContent = CATEGORY_TAGLINE;
      // set view all links
      document.querySelectorAll('[href="/AllProducts/?category=CATEGORY_SLUG"]').forEach(a => a.href = `/AllProducts/?category=${encodeURIComponent(CATEGORY_SLUG)}`);
      document.getElementById('viewAllBtn')?.setAttribute('href', `/AllProducts/?category=${encodeURIComponent(CATEGORY_SLUG)}`);
      document.getElementById('viewAllTop')?.setAttribute('href', `/AllProducts/?category=${encodeURIComponent(CATEGORY_SLUG)}`);
      document.getElementById('viewAllBottom')?.setAttribute('href', `/AllProducts/?category=${encodeURIComponent(CATEGORY_SLUG)}`);

      // render subtype links
      const container = document.getElementById('subtypeLinks');
      if(!container) return;
      container.innerHTML = '';
      if(Array.isArray(SUBTYPES) && SUBTYPES.length){
        SUBTYPES.forEach(s => {
          const a = document.createElement('a');
          a.className = 'block py-1 text-sm';
          a.href = `/AllProducts/?category=${encodeURIComponent(CATEGORY_SLUG)}&${s.query}`;
          a.textContent = s.name;
          container.appendChild(a);
        });
      } else {
        container.innerHTML = '<p class="text-sm">Browse styles and sizes in the full catalog.</p>';
      }
    }

    function findProductById(id){
      // prefer the global numeric 'products' array if present (used by AllProducts sample)
      if(typeof products !== 'undefined' && Array.isArray(products)){
        return products.find(p => Number(p.id) === Number(id));
      }
      // fallback to window.PRODUCTS keyed object (if you maintain a products.js)
      if(window.PRODUCTS && typeof window.PRODUCTS === 'object'){
        // CURATED_IDS may be SKUs in that case, so try direct lookup
        return window.PRODUCTS[id] || Object.values(window.PRODUCTS).find(x => x.id == id);
      }
      // not found
      return null;
    }

    function renderCuratedProducts(){
      const grid = document.getElementById('curatedGrid');
      if(!grid) return;
      grid.innerHTML = '';

      // collect product objects from CURATED_IDS
      const productObjs = CURATED_IDS.map(id => findProductById(id)).filter(Boolean);

      // if none found, show a helpful message
      if(productObjs.length === 0){
        grid.innerHTML = '<div class="p-6 bg-white rounded-lg text-center">No curated items configured. Edit <code>CURATED_IDS</code> in this page to show items.</div>';
        return;
      }

      const favSet = readFavorites();

      for(const p of productObjs){
        // p should have fields: id, title, description, image, price, category (matching your dataset)
        const fontClass = (p.category === 'Veerwear') ? 'veerwear' : (p.category === 'aL vaLe' ? 'plunct' : 'monument');
        const heartActive = favSet.has(Number(p.id));
        const card = document.createElement('div');
        card.className = 'product-card';
        card.innerHTML = `
          <div class="relative overflow-hidden h-64">
            <img src="${p.image || '/images/placeholder-1.jpg'}" alt="${escapeHtml(p.title || '')}" class="w-full h-full object-cover">
            <div class="absolute inset-0 bg-gradient-to-t from-black/30 to-transparent"></div>
            ${p.featured ? `<div class="absolute top-3 left-3 badge-gold">BESTSELLER</div>` : ''}
            <button class="absolute top-3 right-3 heart-btn ${heartActive ? 'heart-active' : ''}" data-id="${p.id}" title="Save to favorites">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="${heartActive ? 'currentColor' : 'none'}" stroke="currentColor" stroke-width="1.5"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"/></svg>
            </button>
          </div>
          <div class="p-4">
            <h3 class="font-medium mb-1 ${fontClass}" style="color:var(--black);">${escapeHtml(p.title || '')}</h3>
            <p class="${fontClass} text-gray-600 text-sm mb-2" style="color:var(--black);">${escapeHtml(p.description || '')}</p>
            <div class="flex justify-between items-center">
              <span class="${fontClass} font-bold" style="color:var(--black);">$${(Number(p.price)||0).toLocaleString()}</span>
              <button class="snipcart-add-item inline-flex items-center px-3 py-2 rounded text-sm border border-transparent bg-amber-600 hover:bg-amber-700"
                data-item-id="${escapeAttr(p.id)}"
                data-item-name="${escapeAttr(p.title || '')}"
                data-item-price="${escapeAttr(p.price||0)}"
                data-item-url="/AllProducts/"
                data-item-description="${escapeAttr(p.description||'')}"
                data-item-image="${escapeAttr(p.image||'')}">
                Add to cart
              </button>
            </div>
          </div>
        `;
        grid.appendChild(card);
      }

      // bind heart toggles for curated grid
      grid.querySelectorAll('.heart-btn').forEach(btn=>{
        btn.addEventListener('click', (e)=>{
          const id = Number(btn.getAttribute('data-id'));
          toggleFavoriteById(id);
        });
      });

      feather.replace();
    }

    // small helpers
    function escapeHtml(s) {
      if(!s) return '';
      return String(s).replace(/[&<>"']/g, function (m) { return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; });
    }
    function escapeAttr(s){ return escapeHtml(String(s)); }

  </script>
</body>
</html>
